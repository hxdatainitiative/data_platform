#    Licensed to the Apache Software Foundation (ASF) under one or more
#    contributor license agreements.  See the NOTICE file distributed with
#    this work for additional information regarding copyright ownership.
#    The ASF licenses this file to You under the Apache License, Version 2.0
#    (the "License"); you may not use this file except in compliance with
#    the License.  You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.

version: "3" 

services: 

  zookeeper: 

    hostname: zookeeper 

    container_name: zookeeper 

    image: 'bitnami/zookeeper:latest' 
   
    environment:
      - ALLOW_ANONYMOUS_LOGIN=yes

    networks:

      - my-net-sql

  nifi: 

    image: "apache/nifi:1.12.1"

    ports: 

      - 8443 #HTTPS Port
      - 1433
      - 1434 
      - 2181 #Puertos zookeeper los 3
      - 2888
      - 3888
      - 6342 #Puerto de equilibrio de carga
      - 9443 #Puerto HTTPS para Nifi UI/API
      - 10443 #Puerto de sitio a sitio
      - 11443 #Puerto de comunicacion de cluster

    environment: 

      - NIFI_WEB_HTTPS_PORT=8443 

      - NIFI_CLUSTER_IS_NODE=true 

      - NIFI_CLUSTER_NODE_PROTOCOL_PORT=8082 

      - NIFI_ZK_CONNECT_STRING=zookeeper:2181 

      - NIFI_ELECTION_MAX_WAI:T=1 min 

      - NIFI_HOME=/opt/nifi/nifi-current 

      - NIFI_LOG_DIR=/opt/nifi/nifi-current/logs 

      - NIFI_TOOLKIT_HOME=/opt/nifi/nifi-toolkit-current 

      - NIFI_PID_DIR=/opt/nifi/nifi-current/run 

      - NIFI_BASE_DIR=/opt/nifi

      - SINGLE_USER_CREDENTIALS_USERNAME:${NIFI_USER}

      - SINGLE_USER_CREDENTIALS_PASSWORD:${NIFI_PASS}


        

    networks:

      - my-net-sql

networks:

  my-net-sql:

    external: true
